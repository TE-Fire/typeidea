{% extends "./base.html" %}

{% block title %}
    {% if tag %}
        标签页: {{ tag.name }}
    {% elif category %}
        分类页: {{ category.name }}
    {% else %}
        首页
    {% endif %}
{% endblock %}

{% block main %}
    <!-- 页面标题区域 -->
    <div class="page-header">
        {% if tag %}
            <h2>标签: {{ tag.name }}</h2>
            <p>查看所有带有 "{{ tag.name }}" 标签的文章</p>
        {% elif category %}
            <h2>分类: {{ category.name }}</h2>
            <p>查看 "{{ category.name }}" 分类下的所有文章</p>
        {% else %}
            <h2>最新文章</h2>
            <p>浏览所有最新发布的文章</p>
        {% endif %}
    </div>

    <!-- 文章列表 -->
    <div class="post-list">
        {% for post in post_list %}
        <div class="post-item">
            <h3 class="post-title">
                <a href="{% url 'post-detail' post.id %}">{{ post.title }}</a>
            </h3>
            <div class="post-meta">
                <span class="post-author">作者: {{ post.owner.username }}</span>
                <span class="post-category">分类: {{ post.category.name }}</span>
                <span class="post-date">发布时间: {{ post.created_time|date:"Y-m-d" }}</span>
            </div>
            <div class="post-excerpt">
                <p>{{ post.desc }}</p>
            </div>
            <div class="post-read-more">
                <a href="{% url 'post-detail' post.id %}" class="read-more-btn">阅读更多</a>
            </div>
        </div>
        {% empty %}
        <div class="no-posts">
            <p>暂无文章</p>
        </div>
        {% endfor %}
    </div>

    <!-- 分页控件 -->
    {% if page_obj and page_obj.paginator.num_pages > 1 %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1" class="pagination-link pagination-first">« 第一页</a>
            <a href="?page={{ page_obj.previous_page_number }}" class="pagination-link pagination-prev">‹ 上一页</a>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <span class="pagination-current">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a href="?page={{ num }}" class="pagination-link">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="pagination-link pagination-next">下一页 ›</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="pagination-link pagination-last">最后一页 »</a>
        {% endif %}
    </div>
    {% endif %}
{% endblock %}